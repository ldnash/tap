<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

	<title>Transportation Alternatives Program Map</title>
	
	<link rel="stylesheet" type="text/css" href="tapstyle.css"/>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDpEfVsRicw2xjhXLhNHUdlqJ6WZEQNCW0&sensor=false"></script>
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript">
	var map;
	var TAPjson;
	
	function initialize() {
		var mapStyle = [{
			  'featureType': 'all',
			  'elementType': 'all',
			  'stylers': [{'visibility': 'off'}]
			}, {
			  'featureType': 'landscape',
			  'elementType': 'geometry',
			  'stylers': [{'visibility': 'on'}, {'color': '#fcfcfc'}]
			}, {
			  'featureType': 'water',
			  'elementType': 'labels',
			  'stylers': [{'visibility': 'off'}]
			}, {
			  'featureType': 'water',
			  'elementType': 'geometry',
			  'stylers': [{'visibility': 'on'}, {'hue': '#5f94ff'}, {'lightness': 60}]
			}];

        var mapOptions = {
			center: new google.maps.LatLng(40, -100),
			zoom: 4,
			styles: mapStyle
        };
        map = new google.maps.Map(document.getElementById("map_canvas"),
            mapOptions);
	
		// Load shape states in geoJSON form
		map.data.loadGeoJson('us-states.json', { idPropertyName : "name" });
		
		map.data.setStyle(styleFeature);

		// Listen for data load
		google.maps.event.addListenerOnce(map.data, 'addfeature', function(){loadData()});	

	}
	
	function loadData(){
	
	map.data.forEach(function(feature){console.log(feature);});
	
	// Get data geoJSON
		$.getJSON( "TAPWebList.json", function( data ) {
			TAPjson = data;
			console.log(TAPjson);
			
			for (i = 0; i < TAPjson.length; i++) {
				
				// Get name of state from TAP list
				var state = TAPjson[i].State;
				console.log(state);
				
				// Pull up corresponding state geography and attach status to geography
				
				var curState = map.data.getFeatureById(state);
				
				curState.setProperty('Status', TAPjson[i]["Status of Statewide Program"]);
				console.log(curState);
						
			}
		});
		
			
		}
		
	function styleFeature(feature){
		var status = feature.getProperty('Status');
		var color = '#666666';
	
		if (status == "Application Process Open or Forthcoming"){
			var color = "#66FF33"}
		if (status == "Initial Application Process Passed"){
			var color = "#FF5050"}
		if (status == "Process in Development, Expected 2014"){
			var color = "#FF9933"}
		if (status == "Still in Development"){
			var color = "#333333"}
	
		return{
			strokeWeight: 1,
			strokeColor: '#fff',
			zIndex: 1,
			fillColor: color,
			fillOpacity: 0.75,
			visible: true
		};
	
	}
	
	
	</script>
</head>

<body onload="initialize();">
	<div id="map_canvas"></div>

	
</body>
</html>