<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

	<title>Transportation Alternatives Program Map</title>

	<link href="bootstrap.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="tapstyle.css"/>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDpEfVsRicw2xjhXLhNHUdlqJ6WZEQNCW0&sensor=false"></script>
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript">
	var map;
	var TAPjson;
	var featureList = [];
	
	function initialize() {
		var mapStyle = [{
			  'featureType': 'all',
			  'elementType': 'all',
			  'stylers': [{'visibility': 'off'}]
			}, {
			  'featureType': 'landscape',
			  'elementType': 'geometry',
			  'stylers': [{'visibility': 'on'}, {'color': '#fcfcfc'}]
			}, {
			  'featureType': 'water',
			  'elementType': 'labels',
			  'stylers': [{'visibility': 'off'}]
			}, {
			  'featureType': 'water',
			  'elementType': 'geometry',
			  'stylers': [{'visibility': 'on'}, {'hue': '#5f94ff'}, {'lightness': 60}]
			}];

        var mapOptions = {
			center: new google.maps.LatLng(40, -100),
			zoom: 4,
			styles: mapStyle,
			scaleControl: false,
			panControl: false,
			streetViewControl: false,
			zoomControl: true,
        };
        map = new google.maps.Map(document.getElementById("map_canvas"),
            mapOptions);
	
		// Load shape states in geoJSON form
		map.data.loadGeoJson('us-states.json', { idPropertyName : "name" });
		
		map.data.setStyle(styleFeature);

		// Listen for data load
		google.maps.event.addListenerOnce(map.data, 'addfeature', function(){loadData()});

		// Listen for click
		map.data.addListener('click', function(event){onClick(event)});			

	}
	
	function loadData(){
	
	map.data.forEach(function(feature){console.log(feature);});
	
	// Get data geoJSON
		$.getJSON( "TAPWebList.json", function( data ) {
			TAPjson = data;
			console.log(TAPjson);
			
			for (i = 0; i < TAPjson.length; i++) {
				
				// Get name of state from TAP list
				var state = TAPjson[i].State;
				console.log(state);
				
				// Pull up corresponding state geography and attach status to geography
				
				var curState = map.data.getFeatureById(state);
				
				// Iterate through each state property and attach to geography
				for (j in TAPjson[i]) {
				
					// Create ordered list of state properties
					var featureName = j
					var featureValue = TAPjson[i][j];

					if (i == 0){
						featureList.push(featureName);
					}					
					
					curState.setProperty(featureName, featureValue);			
				}
			console.log(curState);
			}
		});
		
			
		}
		
	function styleFeature(feature){
		var status = feature.getProperty('Status of Statewide Program');
		var color = '#666666';
	
		if (status == "Application Process Open or Forthcoming"){
			var color = "#66FF33"}
		if (status == "Initial Application Process Passed"){
			var color = "#FF5050"}
		if (status == "Process in Development, Expected 2014"){
			var color = "#FF9933"}
		if (status == "Still in Development"){
			var color = "#333333"}
	
		return{
			strokeWeight: 1,
			strokeColor: '#fff',
			zIndex: 1,
			fillColor: color,
			fillOpacity: 0.75,
			visible: true
		};
	
	}
	
	// When state is clicked
	function onClick(event){
	
	console.log(featureList);
	
	var content = '<h2>'+ event.feature.getId() + '</h2>';
	
	for (i in featureList){
		var newItem = '<p><b>' + featureList[i] + ': </b>' + event.feature.getProperty(featureList[i]) + '</p>';
		content += newItem;
		}
		
	$('#info_body').html(content);
	$('#info_panel').css('display', 'inherit' );
	
	}
	
	
	</script>
</head>

<body onload="initialize();">

<div class = "container" id = "infoCont">
<div class = "row">
	<div class = "col-md-4" id="content_cell">
		<div class="panel panel-default">
			<div class="panel-body">
			<h1>Transportation Alternatives Program Status</h1>
			<h3>For Federal Lands Management Agencies</h3>
			<p>
			The Transportation Alternatives Program (TAP) is a federally funded program under MAP-21 that incorporates the following programs from previous transportation authorizations:
			<ul>
			<li>Transportation Enhancements (TE)</li>
			<li>Recreational Trails Program (RTP)</li>
			<li>Safe Routes to Schools (SRTS)</li>
			</ul>
			</p>
			<p>
			Federal Lands Management Agencies (FLMA) are eligible recipients for TAP funds. However, unlike other programs that can fund FLMA transportation, individual states and metropolitan planning organizations handle applications and distribute funds; they have varying application procedures and timelines.
			</p>
			<p>
			This map consolidates information about state TAP program status. It includes the appropriate contact for each state, who may also be able to inform FLMAs about the TAP status of particular metropolitan areas.
			</p>
			</div>
		</div>
		<div class="panel panel-default" id = "info_panel">
			<div class="panel-body" id = "info_body">
			</div>
		</div>
	</div>
</div>
</div>

<div class = "container-fluid" id = "map_container">
<div class = "row" id = "map_row">
	<div class = "col-md-12" id = "map_col">
		<div id="map_canvas"></div>
	</div>
</div>
</div>

	
</body>
</html>